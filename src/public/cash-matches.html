<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Cash-Matches - Gamermatch</title>
        <meta property="og:title" content="Cash-Matches - Gamermatch" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0" />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap"
            data-tag="font"
        />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" />
        <link rel="stylesheet" href="/style.css" />
        <link rel="stylesheet" href="/cash-matches.css" />
        <link rel="icon" type="image/png" href="/assets/Gamermatch.png" />
        <script src="nav.js" defer></script>
        <script src="notification.js" defer></script>
    </head>

    <body>
        <header class="primary-header flex">
            <a href="/start">
                <img src="assets/Gamermatch.png" alt="Gamermatch Logo" loading="eager" class="logo" />
            </a>

            <button class="mobile-nav-toggle" aria-expanded="false"></button>

            <nav>
                <ul id="primary-navigation" data-visible="false" class="primary-navigation flex">
                    <li class="pfp display-none text-grey">
                        <a href="/@me">
                            <img src="assets/placeholder-pfp.jpeg" alt="profile" />
                        </a>
                        <h5 id="balance-mobile" style="margin: auto 0">Balance: $</h5>
                    </li>
                    <li class="active">
                        <a href="/start" class="text-white white-space-nowrap">Home</a>
                    </li>
                    <li>
                        <a href="/cash-matches" class="active text-white white-space-nowrap">Cash Matches</a>
                    </li>
                    <!--<li>
                        <a href="/teams" class="text-white white-space-nowrap">Leaderboard</a>
                    </li>-->
                    <!--<li>
                        <a href="/leaderboard" class="text-white white-space-nowrap">Leaderboard</a>
                    </li>-->
                    <li id="logout" class="flex flex-row" onclick="logout()">
                        <img src="assets/logout-icon.svg" alt="logout" />
                        <a href="#" class="text-white white-space-nowrap" id="logout--text">Logout</a>
                    </li>
                </ul>
            </nav>

            <a class="ongoing-button button-small" id="ongoingmatchbutton" style="display: none" href="#">BACK TO GAME</a>

            <div class="nav-buttons flex">
                <button class="login-button button-small" onclick="showLogin()" id="loginbutton">LOG IN</button>
                <button class="signup-button button-small" onclick="showSignUp()" id="signupbutton">SIGN UP</button>
            </div>

            <div class="loggedin-menu flex">
                <button class="noti-toggle"></button>
                <a onclick="togglePopup()">
                    <img src="assets/placeholder-pfp.jpeg" class="profile-menu-toggle" alt="profile" />
                </a>
            </div>
            <div class="profile-menu text-grey flex" id="menu_popup">
                <h5 id="balance">Not Logged In</h5>
                <div class="ongoing-match" id="profilelink" style="display: none">
                    <a href="/@me">Profile</a>
                </div>
                <div class="logout flex" onclick="logout()" id="logoutbutton" style="display: none">
                    <img src="assets/logout-icon.svg" alt="" />
                    <a>Logout</a>
                </div>
            </div>
            <div class="noti-container text-grey" data-visible="false">
                <h5>Notifications</h5>
                <div class="noti" id="no-new-noti" style="display: none">
                    <img src="assets/Inbox.svg" alt="empty inbox" />
                    <span>No new notifications</span>
                </div>
            </div>
        </header>
        <div class="wrapper flex">
            <div class="signup_container">
                <div class="blocker" onclick="hideSignUp()"></div>
                <div class="SignUp" id="SignUp">
                    <label for="" class="close-btn fas fa-times" onclick="hideSignUp()"></label>
                    <div class="text">Sign Up</div>
                    <form action="#">
                        <div class="data">
                            <label>Username*</label>
                            <input type="text" id="username" required />
                        </div>
                        <div class="data">
                            <label>Email*</label>
                            <input type="email" id="mail" required />
                        </div>
                        <div class="data">
                            <label>Password*</label>
                            <input name="password" id="password" type="password" onkeyup="check();" required />
                        </div>
                        <div class="data">
                            <label>Repeat Password*</label>
                            <input name="repeat_password" id="repeat_password" type="password" onkeyup="check();" required />
                            <div id="message">Passwords do not match!</div>
                        </div>
                        <div class="btn">
                            <div class="inner"></div>
                            <button type="button" onclick="signup()">Sign Up</button>
                            <div id="signupmessages"></div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="login_container">
                <div class="blocker" onclick="hideLogin()"></div>
                <div class="Login" id="Login">
                    <label for="" class="close-btn fas fa-times" onclick="hideLogin()"></label>
                    <div class="text">Log In</div>
                    <form action="#">
                        <div class="data">
                            <label>Username</label>
                            <input type="text" id="username_login" required />
                        </div>
                        <div class="data">
                            <label>Password</label>
                            <input name="password" id="password_login" type="password" required />
                        </div>
                        <span id="forgotPassword">Forgot your password?</span>
                        <div class="btn">
                            <div class="inner"></div>
                            <button type="button" id="loginbutton" onclick="login()">Log In</button>
                            <div id="messages_login"></div>
                        </div>
                        <span>Dont have an account?</span><span id="SignUp-refer" onclick="hideLogin(), showSignUp()">SignUp</span>
                    </form>
                </div>
            </div>
            <div class="password_container">
                <div class="blocker" onclick="hidePWReset()"></div>
                <div class="Login" id="Login">
                    <label for="" class="close-btn fas fa-times" onclick="hidePWReset()"></label>
                    <div class="text">Reset Password</div>
                    <form action="#">
                        <div class="data">
                            <label>Email you registered with</label>
                            <input name="mail" id="mail_pw" type="email" required />
                        </div>
                        <div class="btn">
                            <div class="inner"></div>
                            <button type="button" onclick="resetPW()">Reset Password</button>
                            <div id="messages_pw"></div>
                        </div>
                    </form>
                </div>
            </div>
            <script>
                const popup_signup = document.querySelector('.signup_container');
                const popup_login = document.querySelector('.login_container');
                const popup_reset = document.querySelector('.password_container');
                function showSignUp() {
                    popup_signup.classList.add('open');
                }
                function hideSignUp() {
                    popup_signup.classList.remove('open');
                }
                function showLogin() {
                    popup_login.classList.add('open');
                }
                function hideLogin() {
                    popup_login.classList.remove('open');
                }
                function showPWReset() {
                    popup_reset.classList.add('open');
                }
                function hidePWReset() {
                    popup_reset.classList.remove('open');
                }
                function logout() {
                    document.cookie = 'auth=; Max-Age=0';
                    window.location.href = '/';
                }
                function togglePopup() {
                    document.querySelector('.noti-container').setAttribute('data-visible', false);
                    if (document.getElementById('menu_popup').style.display == 'none' || document.getElementById('menu_popup').style.display == '')
                        document.getElementById('menu_popup').style.display = 'block';
                    else document.getElementById('menu_popup').style.display = 'none';
                }
                async function base_data() {
                    let data = await (
                        await fetch('/api/v1/users/@me/start', {
                            method: 'GET',
                        })
                    ).json();
                    if (!data.error) {
                        document.getElementById('balance').innerHTML = `Balance: $${data.balance.toFixed(2)}`;
                        document.getElementById('balance-mobile').innerHTML = `Balance: $${data.balance.toFixed(2)}`;
                        document.getElementById('profilelink').style.display = 'block';
                        document.getElementById('logoutbutton').style.display = 'block';
                        if (data.url) {
                            document.getElementById('ongoingmatchbutton').style.display = 'block';
                            document.getElementById('ongoingmatchbutton').href = data.url;
                        }
                        if (!data.notifications.length) document.getElementById('no-new-noti').style.display = 'block';
                        for (let i = 0; data.notifications.length > i; i++) {
                            const noti_parent = document.createElement('div');
                            noti_parent.classList = 'noti';
                            noti_parent.id = `delete_noti_${data.notifications[i].id}`;
                            const text = document.createElement('span');
                            text.innerHTML = data.notifications[i].string;
                            const button_parent = document.createElement('div');
                            button_parent.classList = 'noti-icons flex';
                            if (data.notifications[i].type == 'TEAM_REQUEST') {
                                const button = document.createElement('button');
                                button.classList = 'button-small';
                                button.innerHTML = 'Accept Invite';
                                button.setAttribute('onclick', `acceptInvite('${data.notifications[i].metadata.id}', '${data.notifications[i].id}')`);
                                button_parent.append(button);
                            } else {
                                const img = document.createElement('img');
                                img.src = 'assets/cross.svg';
                                img.setAttribute('onclick', `read('${data.notifications[i].id}')`);
                                img.id = 'cross';
                                button_parent.append(img);
                            }
                            noti_parent.append(text);
                            noti_parent.append(button_parent);
                            document.getElementsByClassName('noti-container text-grey')[0].append(noti_parent);
                        }
                    }
                }
                base_data();
                async function acceptInvite(id, noti_id) {
                    let data = await (
                        await fetch(`/api/v1/teams/${id}/join`, {
                            method: 'POST',
                        })
                    ).json();
                    if (data.error) return alert(`Error: ${data.errors[0].message}`);
                    read(noti_id);
                }
                async function read(id) {
                    let data = await (
                        await fetch(`/api/v1/users/@me/notifications/read/${id}`, {
                            method: 'POST',
                        })
                    ).json();
                    //if (data.error) return alert(`Error: ${data.errors[0].message}`);
                    document.getElementById(`delete_noti_${id}`).remove();
                }
                var check = function () {
                    if (document.getElementById('password').value == document.getElementById('repeat_password').value) {
                        document.getElementById('message').style.opacity = '0';
                        document.getElementById('signup_button').disabled = false;
                    } else {
                        document.getElementById('message').style.opacity = '1';
                        document.getElementById('signup_button').disabled = true;
                    }
                };
                async function signup() {
                    let data = await (
                        await fetch('/api/v1/users/create', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                username: document.getElementById('username').value,
                                password: document.getElementById('password').value,
                                mail: document.getElementById('mail').value,
                                referal: getQuery('referal'),
                            }),
                        })
                    ).json();
                    if (data.errors) {
                        document.getElementById('signupmessages').classList = `message_failed`;
                        document.getElementById('signupmessages').innerHTML = `Error: ${data.errors[0].message}`;
                        document.getElementById('signupmessages').style.opacity = '1';
                        setTimeout(() => {
                            document.getElementById('signupmessages').style.opacity = '0';
                        }, 3000);
                        return;
                    }
                    document.getElementById('signupmessages').classList = `message_success`;
                    document.getElementById('signupmessages').innerHTML = `Account Created`;
                    document.getElementById('signupmessages').style.opacity = '1';
                    document.getElementById('signupbutton').style.display = 'none';
                    setTimeout(() => {
                        document.getElementById('signupmessages').style.opacity = '0';
                        hideSignUp();
                    }, 3000);
                }
                async function login() {
                    let data = await (
                        await fetch('/api/v1/users/login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                username: document.getElementById('username_login').value,
                                password: document.getElementById('password_login').value,
                            }),
                        })
                    ).json();
                    if (data.errors) {
                        document.getElementById('messages_login').classList = `message_failed`;
                        document.getElementById('messages_login').innerHTML = `Error: ${data.errors[0].message}`;
                        document.getElementById('messages_login').style.opacity = '1';
                        setTimeout(() => {
                            document.getElementById('messages_login').style.opacity = '0';
                        }, 3000);
                        return;
                    }
                    document.getElementById('messages_login').classList = `message_success`;
                    document.getElementById('messages_login').innerHTML = `Logged In`;
                    document.getElementById('messages_login').style.opacity = '1';
                    document.getElementById('signupbutton').style.display = 'none';
                    setTimeout(() => {
                        window.location.reload();
                    }, 3000);
                }
                async function resetPW() {
                    let data = await (
                        await fetch('/api/v1/users/@me/reset-mail', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                mail: document.getElementById('mail_pw').value,
                            }),
                        })
                    ).json();
                    if (data.errors) {
                        document.getElementById('messages_pw').classList = `message_failed`;
                        document.getElementById('messages_pw').innerHTML = `Error: ${data.errors[0].message}`;
                        document.getElementById('messages_pw').style.opacity = '1';
                        setTimeout(() => {
                            document.getElementById('messages_pw').style.opacity = '0';
                        }, 3000);
                        return;
                    }
                    document.getElementById('messages_pw').classList = `message_success`;
                    document.getElementById('messages_pw').innerHTML = `E-Mail send`;
                    document.getElementById('messages_pw').style.opacity = '1';
                    setTimeout(() => {
                        window.location.reload();
                    }, 3000);
                }
                function getQuery(param) {
                    const urlParams = new URLSearchParams(window.location.search);
                    return urlParams.get(param) ?? null;
                }
                function getCookie(name) {
                    var nameEQ = name + '=';
                    var ca = document.cookie.split(';');
                    for (var i = 0; i < ca.length; i++) {
                        var c = ca[i];
                        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
                    }
                    return null;
                }
                if (getCookie('auth')) document.getElementById('signupbutton').style.display = 'none';
                if (getCookie('auth')) document.getElementById('loginbutton').style.display = 'none';
            </script>
            <!-- Create Match Pop Up  -->
            <div class="create__container">
                <div class="blocker" onclick="hideCreateMatch()"></div>
                <div class="CreateMatch text-grey" id="CreateMatch">
                    <label for="" class="close-btn fas fa-times" onclick="hideCreateMatch()"></label>
                    <div class="text">Create Match</div>
                    <form action="#">
                        <div class="createMatch__Selections">
                            <label>Entry Fee / Player</label>
                            <div class="currency-container">
                                <p>$</p>
                                <input type="number" id="fee_create" class="inputData" min="0.25" step="any" placeholder="0.25" required />
                            </div>
                            <label>Gamemode</label>
                            <select class="selectionData" id="type_create" required>
                                <option value="" disabled selected hidden>Select gamemode</option>
                                <option value="Zone Wars">Zone Wars</option>
                                <option value="Box Fights">Box Fights</option>
                                <option value="Realistics">Realistics</option>
                            </select>
                            <label>Region</label>
                            <select class="selectionData" id="region_create" required>
                                <option value="" disabled selected hidden>Select region</option>
                                <option value="EU">EU</option>
                                <option value="NAE">NAE</option>
                                <option value="NAW">NAW</option>
                                <option value="OCE">OCE</option>
                            </select>
                            <label>Teamsize</label>
                            <select class="selectionData" id="size_create" required>
                                <option value="" disabled selected hidden>Select teamsize</option>
                                <option value="1">1v1</option>
                                <option value="2">2v2</option>
                                <option value="3">3v3</option>
                                <option value="4">4v4</option>
                            </select>
                            <label>Platforms</label>
                            <select class="selectionData" id="platforms_create" required>
                                <option value="" disabled selected hidden>Select Platform</option>
                                <option value="pc">PC</option>
                                <option value="console">Console</option>
                                <option value="all">All Platforms</option>
                            </select>
                            <label>First To</label>
                            <select class="selectionData" id="firstto_create" required>
                                <option value="" disabled selected hidden>Select First To</option>
                                <option value="3">First To 3</option>
                                <option value="5">First To 5</option>
                                <option value="7">First To 7</option>
                            </select>
                            <label>Team</label>
                            <select class="selectionData" id="teamids_create" required>
                                <option value="" id="teamids_create_option" disabled selected hidden>Select team</option>
                            </select>
                            <!--<input type="checkbox" name="cover fees" id="coverFeesCreate" />
                            <label>Cover fees</label>-->
                        </div>
                        <div class="btn">
                            <div class="inner"></div>
                            <button type="button" id="createMatchButton" onclick="CreateMatch()">Create Match</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Join Match Pop Up -->
            <div class="join__container">
                <div class="blocker" onclick="hideJoinMatch()"></div>
                <div class="JoinMatch text-grey" id="JoinMatch">
                    <label for="" class="close-btn fas fa-times" onclick="hideJoinMatch()"></label>
                    <div class="text">Join Match</div>
                    <form action="#">
                        <div class="JoinMatch__Selections">
                            <div class="EntryFee_container">
                                <span>Entry Fee/Player:</span>
                                <p id="entry_fee"></p>
                            </div>
                            <label>Team</label>
                            <select class="selectionData" id="teamids_join" required>
                                <option value="" id="teamids_join_option" disabled selected hidden>Select team</option>
                            </select>
                            <!--<input type="checkbox" name="cover fees" id="coverFeesJoin" />
                            <label>Cover fees</label>-->
                        </div>
                        <div class="btn">
                            <div class="inner"></div>
                            <button type="button" id="joinMatchButton" off>Join Match</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Site Content -->
            <div class="content maxwidth">
                <div class="hero flex flex-column text-white">
                    <h2>Cash Matches</h2>
                    <span> Create or join a match to compete for cash prices</span>
                </div>
                <div class="cash-matches">
                    <div class="filter-container">
                        <button class="create-match-button button-small radius-8" onclick="showCreateMatch()" id="cashmatchcreation">Create Cash Match</button>
                        <div class="filters flex flex-column">
                            <select class="options__filter--input" id="gamemode_filter">
                                <option value="Gamemode" selected="">Gamemode</option>
                                <option value="Zone Wars">Zone Wars</option>
                                <option value="Box Fights">Box Fights</option>
                                <option value="Realistics">Realistics</option>
                            </select>
                            <select class="options__filter--input" id="gamemode_region">
                                <option value="Region" selected="">Region</option>
                                <option value="EU">EU</option>
                                <option value="NAE">NAE</option>
                                <option value="NAW">NAW</option>
                                <option value="OCE">OCE</option>
                            </select>
                            <select class="options__filter--input" id="gamemode_size">
                                <option value="Size" selected="">Size</option>
                                <option value="1">1v1</option>
                                <option value="2">2v2</option>
                                <option value="3">3v3</option>
                                <option value="4">4v4</option>
                            </select>
                            <select class="options__filter--input" id="gamemode_platform">
                                <option value="Platform" selected="">Platform</option>
                                <option value="pc">PC</option>
                                <option value="console">Console</option>
                                <option value="all">All Platforms</option>
                            </select>
                        </div>
                    </div>
                    <div class="match__activeGames"></div>
                </div>
            </div>
        </div>
        <footer class="flex flex-column">
            <div class="footer-content flex text-white maxwidth">
                <a href="/start">
                    <img src="assets/Gamermatch.png" alt="Gamermatch Logo" loading="eager" class="logo" id="footer-logo" />
                </a>
                <ul class="secondary-navigation">
                    <li><a href="/start" style="color: white">Home</a></li>
                    <li><a href="/cash-matches" style="color: white">Cash Matches</a></li>
                    <!--<li><a href="/leaderboard" style="color: white">Leaderboard</a></li>-->
                    <!--<li><a href="/profile" style="color: white">Profile</a></li>-->
                </ul>
                <ul class="secondary-navigation">
                    <li><a href="/rules" style="color: white">Rules</a></li>
                    <li><a href="https://discord.com/invite/gamermatch" style="color: white">Support</a></li>
                    <li><a href="/privacy" style="color: white">Privacy Policy</a></li>
                    <li><a href="/terms-of-service" style="color: white">Terms of Service</a></li>
                </ul>
                <div class="socials flex">
                    <img alt="Twitter" src="assets/Twitter.png" onclick="window.location.href='https://twitter.com/GamerMatchGG'" />
                    <img alt="Discord" src="assets/Discord.png" onclick="window.location.href='https://discord.gg/Eb5fqBSSHm'" />
                </div>
            </div>
            <span class="copyright text-grey">@ 2023 UltimateTokens LLC</span>
        </footer>
        <script>
            document.getElementById('gamemode_region').addEventListener('change', filter);
            document.getElementById('gamemode_size').addEventListener('change', filter);
            document.getElementById('gamemode_filter').addEventListener('change', filter);
            document.getElementById('gamemode_platform').addEventListener('change', filter);
            async function filter(event) {
                document.getElementsByClassName('match__activeGames')[0].innerHTML = '';
                const search = new URLSearchParams();
                if (document.getElementById('gamemode_filter').value != 'Gamemode') search.append('type', document.getElementById('gamemode_filter').value);
                if (document.getElementById('gamemode_region').value != 'Region') search.append('region', document.getElementById('gamemode_region').value);
                if (document.getElementById('gamemode_size').value != 'Size') search.append('size', document.getElementById('gamemode_size').value);
                if (document.getElementById('gamemode_platform').value != 'Platform') search.append('platforms', document.getElementById('gamemode_platform').value);
                dbsearch(`?${search.toString()}`);
            }
            var available_wagers;
            function getCookie(name) {
                var nameEQ = name + '=';
                var ca = document.cookie.split(';');
                for (var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            }
            if (!getCookie('auth')) document.getElementById('cashmatchcreation').disabled = true;
            async function dbsearch(query) {
                let data = await (
                    await fetch(`/api/v1/wagers/search${query ?? ''}`, {
                        method: 'GET',
                    })
                ).json();
                if (!data.error) {
                    available_wagers = data;
                    for (let i = 0; data.length > i; i++) {
                        generateMatch(data[i]);
                    }
                }
                socket();
            }
            dbsearch();
            function generateMatch(data) {
                const matchitem = document.createElement('div');
                matchitem.classList = 'match__item';
                matchitem.id = `match_${data.id}`;
                const title_h1 = document.createElement('h1');
                title_h1.classList = 'match__gamemode';
                title_h1.innerHTML = data.type;
                matchitem.append(title_h1);

                const body_parent = document.createElement('div');
                body_parent.classList = 'match__information';

                const body_desc = document.createElement('div');
                body_desc.classList = 'match__information--title';
                const fee_desc = document.createElement('span');
                fee_desc.innerHTML = 'Entry Fee';
                const region_desc = document.createElement('span');
                region_desc.innerHTML = 'Region';
                const size_desc = document.createElement('span');
                size_desc.innerHTML = 'Teamsize';
                const platform_desc = document.createElement('span');
                platform_desc.innerHTML = 'Platform';
                const firstto_desc = document.createElement('span');
                firstto_desc.innerHTML = 'First To';
                body_desc.append(fee_desc);
                body_desc.append(region_desc);
                body_desc.append(size_desc);
                body_desc.append(platform_desc);
                body_desc.append(firstto_desc);
                body_parent.append(body_desc);

                const body_value = document.createElement('div');
                body_value.classList = 'match__information--stats';
                const fee_value = document.createElement('span');
                fee_value.classList = 'match__region';
                fee_value.innerHTML = `$${data.fee}`;
                const region_value = document.createElement('span');
                region_value.classList = 'match__region';
                region_value.innerHTML = data.region;
                const size_value = document.createElement('span');
                size_value.classList = 'match__platforms';
                size_value.innerHTML = `${data.size}v${data.size}`;
                const platform_value = document.createElement('span');
                platform_value.classList = 'match__platforms';
                platform_value.innerHTML = data.platforms;
                const firstto_value = document.createElement('span');
                firstto_value.innerHTML = data.first_to ?? 'Not available (old match)';
                firstto_value.classList = 'match__platforms';
                body_value.append(fee_value);
                body_value.append(region_value);
                body_value.append(size_value);
                body_value.append(platform_value);
                body_value.append(firstto_value);
                body_parent.append(body_value);

                const button = document.createElement('button');
                button.disabled = getCookie('auth') ? false : true;
                button.classList = 'match__join button';
                button.innerHTML = data.visible_only ? 'View' : 'Join';
                if (data.visible_only) button.setAttribute('onclick', `window.location.href='/games?id=${data.id}'`);
                else button.setAttribute('onclick', `showJoinMatch('${data.id}')`);

                matchitem.append(body_parent);
                matchitem.append(button);

                document.getElementsByClassName('match__activeGames')[0].append(matchitem);
            }
            const createPopup = document.querySelector('.create__container');
            async function showCreateMatch() {
                createPopup.classList.add('create_open');
                let data = await (
                    await fetch('/api/v1/users/@me/teams', {
                        method: 'GET',
                    })
                ).json();
                if (!data || !data.teams.length) {
                    document.getElementById('teamids_create').disabled = true;
                    document.getElementById('teamids_create_option').innerHTML = 'No Teams found, join one first';
                    document.getElementById('createMatchButton').disabled = true;
                    document.getElementById('createMatchButton').style.backgroundColor = '#121212';
                }
                for (let i = 0; data.teams.length > i; i++) {
                    const parent = document.getElementById('teamids_create');
                    const coption = document.createElement('option');
                    coption.value = data.teams[i].id;
                    coption.innerHTML = data.teams[i].name;
                    parent.append(coption);
                }
                document.getElementById('joinMatchButton').setAttribute('onclick', `CreateMatch()`);
            }
            function hideCreateMatch() {
                document.getElementById('teamids_create').innerHTML = '';
                createPopup.classList.remove('create_open');
            }
            async function CreateMatch() {
                let data = await (
                    await fetch(`/api/v1/wagers/create`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            fee: Number(document.getElementById('fee_create').value),
                            size: Number(document.getElementById('size_create').value),
                            region: document.getElementById('region_create').value,
                            type: document.getElementById('type_create').value,
                            team: document.getElementById('teamids_create').value,
                            first_to: Number(document.getElementById('firstto_create').value),
                            game: 'Fortnite',
                            platforms: document.getElementById('platforms_create').value,
                            cover: false, //document.getElementById('coverFeesCreate').checked,
                        }),
                    })
                ).json();
                if (data.errors) return alert('Error: ' + data.errors[0].message);
                window.location.href = `/games?id=${data.created.id}`;
            }
            const joinPopup = document.querySelector('.join__container');
            async function showJoinMatch(id) {
                joinPopup.classList.add('join__open');
                let data = await (
                    await fetch('/api/v1/users/@me/teams', {
                        method: 'GET',
                    })
                ).json();
                if (!data || !data.teams.length) {
                    document.getElementById('teamids_join').disabled = true;
                    document.getElementById('teamids_join_option').innerHTML = 'No Teams found, join one first';
                    document.getElementById('joinMatchButton').disabled = true;
                    document.getElementById('joinMatchButton').style.backgroundColor = '#121212';
                }
                for (let i = 0; data.teams.length > i; i++) {
                    const parent = document.getElementById('teamids_join');
                    const coption = document.createElement('option');
                    coption.value = data.teams[i].id;
                    coption.innerHTML = data.teams[i].name;
                    parent.append(coption);
                }
                const wager = available_wagers.find(i => i.id == id);
                document.getElementById('entry_fee').innerHTML = `$${wager.fee}`;
                document.getElementById('joinMatchButton').setAttribute('onclick', `JoinMatch('${id}')`);
            }
            function hideJoinMatch() {
                document.getElementById('teamids_join').innerHTML = '';
                joinPopup.classList.remove('join__open');
            }
            async function JoinMatch(id) {
                let data = await (
                    await fetch(`/api/v1/wagers/${id}/join`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            team: document.getElementById('teamids_join').value,
                            cover: false, //document.getElementById('coverFeesJoin').checked,
                        }),
                    })
                ).json();
                if (data.errors) return alert('Error: ' + data.errors[0].message);
                window.location.href = `/games?id=${id}`;
            }
            const loginPopup = document.querySelector('.login_container');
            function showLogin() {
                loginPopup.classList.add('open');
            }
            function hideLogin() {
                loginPopup.classList.remove('open');
            }
            const menuPopup = document.querySelector('.mobileMenu_container');
            function showMobileMenu() {
                menuPopup.classList.add('open');
            }
            function hideMobileMenu() {
                menuPopup.classList.remove('open');
            }
            const signupPopup = document.querySelector('.signup_container');
            function showSignup() {
                signupPopup.classList.add('open');
            }
            function hideSignup() {
                signupPopup.classList.remove('open');
            }
            var check = function () {
                if (document.getElementById('set_password').value == document.getElementById('repeat_password').value) {
                    document.getElementById('message').style.opacity = '0';
                } else {
                    document.getElementById('message').style.opacity = '1';
                }
            };
            async function socket() {
                var socket = io({
                    auth: {
                        type: 'cash-matches',
                    },
                });
                socket.on('WAGER_CREATED', msg => {
                    generateMatch(msg);
                    available_wagers.push(msg);
                });
                socket.on('WAGER_JOINED', msg => {
                    document.getElementById(`match_${msg.id}`).remove();
                });
            }
        </script>
        <script src="socket-io.min.js"></script>
    </body>
</html>
